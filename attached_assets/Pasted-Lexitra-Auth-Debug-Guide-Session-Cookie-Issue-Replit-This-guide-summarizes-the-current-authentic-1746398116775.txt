Lexitra Auth Debug Guide: Session Cookie Issue (Replit)

This guide summarizes the current authentication issue experienced on Replit and outlines the likely causes and solutions.

â¸»

ğŸš¨ Problem Summary
	â€¢	Login request is successful, but authentication does not persist.
	â€¢	All API requests after login show req.headers.cookie as undefined.
	â€¢	Server creates a new session ID on every request â†’ session is not maintained.

â¸»

ğŸ” Potential Root Causes

âœ… 1. Missing credentials: 'include' in client requests

Ensure all fetch or Axios requests include:

fetch(url, {
  method: 'POST',
  body: JSON.stringify(...),
  credentials: 'include',
});

This includes any React Query or custom hooks using fetch.

â¸»

âœ… 2. Improper CORS settings on the server

Use specific origin, not *, when enabling credentials:

app.use(cors({
  origin: 'http://localhost:5173',  // Replace with your frontend URL
  credentials: true
}));

â— credentials: true is ignored if origin is set to *

â¸»

âœ… 3. Cookie options conflict with local environment

Your current config:

cookie: {
  secure: false,              // Good for local
  httpOnly: true,
  sameSite: 'lax'             // Good for local too
}

âœ… Recommended for local:

	â€¢	secure: false
	â€¢	sameSite: 'lax'

âš ï¸ If you set sameSite: 'none', you must also set secure: true, which only works over HTTPS.

â¸»

âœ… Debug Checklist

Check Item	Status
Client requests include credentials: 'include'?	âœ…
Server cors() has exact origin + credentials: true?	âœ…
Cookie config is correct for local dev?	âœ…
Cookie appears in Set-Cookie response header?	â¬œ
Cookie is stored in browser (DevTools â†’ Application â†’ Cookies)?	â¬œ



â¸»

ğŸ§ª Files Involved (See zip bundle)
	â€¢	server/auth.ts: session and cookie setup
	â€¢	server/routes.ts: routes and auth checks
	â€¢	client/src/hooks/use-auth.tsx: login and session fetch logic
	â€¢	client/src/lib/queryClient.ts: API layer config

â¸»

ğŸ§© Recommendation

Ensure that:
	â€¢	All client API calls use credentials: 'include'
	â€¢	Server CORS origin is exact and not using *
	â€¢	Cookie config uses secure: false, sameSite: 'lax' for local

Then: test in browser
	â€¢	Check for Set-Cookie in login response
	â€¢	Check that cookie is saved and sent in following requests

Let me know if deeper network/DevTools debugging is needed.