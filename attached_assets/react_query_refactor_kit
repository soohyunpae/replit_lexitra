# React Query ê¸°ë°˜ ë¦¬íŒ©í† ë§ ì§€ì› ë¬¸ì„œ

ì´ ë¬¸ì„œëŠ” Lexitra í”„ë¡œì íŠ¸ì˜ React Query ê¸°ë°˜ ë¦¬íŒ©í† ë§ì„ Replit ë˜ëŠ” ë‹¤ë¥¸ í˜‘ì—… ëŒ€ìƒì—ê²Œ ìš”ì²­í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë³´ì¡° ìë£Œì…ë‹ˆë‹¤.

---

## âœ… 1. ë¦¬íŒ©í† ë§ ë¡œë“œë§µ ë¬¸ì„œ

ì´ë¯¸ ì‘ì„±ëœ `react_migration_plan.md` íŒŒì¼ì—ëŠ” ë‹¤ìŒ ë‚´ìš©ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

* ìƒíƒœ ê´€ë¦¬ ì „í™˜: Context â†’ React Query
* ë””ë ‰í† ë¦¬ êµ¬ì¡° ê°œì„ 
* API fetch/mutation í†µì¼ ì „ëµ
* TM, ìš©ì–´ì§‘, ì„¸ê·¸ë¨¼íŠ¸ êµ¬ì¡° ì •ë¦¬ ì œì•ˆ
* ëª¨ë“ˆí™”ëœ ì»´í¬ë„ŒíŠ¸ ì„¤ê³„ ë°©í–¥

ì°¸ê³  íŒŒì¼: `/docs/react_migration_plan.md`

---

## âœ… 2. API ì‘ë‹µ ì˜ˆì‹œ ëª¨ìŒ

### ğŸ“˜ `/api/projects`

```json
[
  {
    "id": 1,
    "name": "My Project",
    "files": [
      {
        "id": 101,
        "name": "intro.txt"
      }
    ]
  }
]
```

### ğŸ“— `/api/projects/1/stats`

```json
{
  "wordCount": 540,
  "translatedPercentage": 87.3,
  "reviewedPercentage": 45.5,
  "statusCounts": {
    "100%": 120,
    "Fuzzy": 34,
    "MT": 112,
    "Reviewed": 84,
    "Edited": 15,
    "Rejected": 3
  },
  "totalSegments": 368
}
```

### ğŸ“• `/api/segments?fileId=101`

```json
[
  {
    "id": 1001,
    "source": "This is a test segment.",
    "target": "ì´ê²ƒì€ í…ŒìŠ¤íŠ¸ ë¬¸ì¥ì…ë‹ˆë‹¤.",
    "status": "MT"
  }
]
```

### ğŸ“’ `/api/segments/1001` (PATCH)

```json
{
  "target": "ìˆ˜ì •ëœ ë²ˆì—­ë¬¸",
  "status": "Edited"
}
```

---

## âœ… 3. ë¦¬íŒ©í† ë§ ìš°ì„ ìˆœìœ„ ì •ë¦¬

### ğŸ”¹ Phase 1: í•µì‹¬ í˜ì´ì§€ ë° ë°ì´í„° íë¦„ ë¦¬íŒ©í† ë§

* `/app/projects.tsx` â†’ í”„ë¡œì íŠ¸ ëª©ë¡ + ë‹¨ì–´ ìˆ˜ fetch í†µì¼
* `/app/project.tsx` â†’ ìƒì„¸ ë‹¨ì–´ ìˆ˜, segment fetch í†µì¼
* `/app/translation/page.tsx` â†’ ì—ë””í„° êµ¬ì¡° ë¶„í•´, ìƒíƒœ í†µì¼
* `/components/segment/editable-segment.tsx` â†’ mutation hook ì ìš©

### ğŸ”¹ Phase 2: TM/Glossary ë° ê´€ë¦¬ì ê¸°ëŠ¥ ë¶„ë¦¬

* `/app/tm_management/page.tsx`
* `/app/termbase/page.tsx`
* `/components/tm/TMMatches.tsx`, `TMSuggestion.tsx`

---

## âœ… 4. Replit ì „ë‹¬ìš© ìš”ì•½

ì´ í”„ë¡œì íŠ¸ëŠ” í˜„ì¬ React Queryì™€ ê¸°ì¡´ Context ìƒíƒœ ê´€ë¦¬ê°€ í˜¼í•©ëœ êµ¬ì¡°ì…ë‹ˆë‹¤. ì „ì²´ ë¦¬íŒ©í† ë§ ëª©í‘œëŠ”:

* ëª¨ë“  ì„œë²„ ë°ì´í„° fetch â†’ `useQuery` ê¸°ë°˜ í†µì¼
* ëª¨ë“  ë°ì´í„° ë³€ê²½ â†’ `useMutation` + `queryClient.invalidateQueries()` ì ìš©
* ë””ë ‰í† ë¦¬ êµ¬ì¡° â†’ `/hooks/queries`, `/mutations`, `/states`, `/components/translation` ë“± ëª¨ë“ˆí™”
* TM, ìš©ì–´ì§‘, Segment, í”„ë¡œì íŠ¸ ìƒíƒœ ë“±ì˜ ìƒíƒœ ì¼ê´€ì„± í™•ë³´

ìš°ì„ ìˆœìœ„ëŠ” ìœ„ì— ëª…ì‹œëœ Phase 1 íŒŒì¼ë“¤ì…ë‹ˆë‹¤. ê° ë‹¨ê³„ë³„ë¡œ ì ì§„ì  refactoringì´ ê°€ëŠ¥í•˜ë©°, `react_migration_plan.md`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‘ì—…í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.

---

## âœ… 6. ì¢…í•© ì •ë¦¬ ë° Replit í”¼ë“œë°± ìš”ì•½

- âœ… API ì‘ë‹µ ì˜ˆì‹œê°€ ëª…í™•í•˜ê²Œ ë¬¸ì„œí™”ë˜ì–´ ìˆì–´ ì¸í„°í˜ì´ìŠ¤ ì„¤ê³„ê°€ ëª…í™•í•¨  
- âœ… Phase 1ê³¼ 2ë¡œ ìš°ì„ ìˆœìœ„ë¥¼ ë‚˜ëˆ„ì–´ ì ì§„ì  ë¦¬íŒ©í† ë§ ê°€ëŠ¥  
- âœ… ë””ë ‰í† ë¦¬ êµ¬ì¡° ê°œì„  ë°©í–¥ì´ êµ¬ì²´ì 

---

### ğŸ”¸ ì¶”ê°€ ì œì•ˆ: `queryKey` ìƒìˆ˜í™”

```ts
const queryKeys = {
  projects: ['projects'] as const,
  project: (id: number) => ['projects', id] as const,
  segments: (fileId: number) => ['segments', fileId] as const,
  tm: ['tm'] as const,
  glossary: ['glossary'] as const
};
```

â†’ `invalidateQueries()`ê°€ ì•ˆì •ì ìœ¼ë¡œ ë™ì‘í•˜ê³ , hookë“¤ ê°„ key ê´€ë¦¬ê°€ ì¼ê´€ë¨

---

### ğŸ”¸ ê¸°íƒ€ ì „ëµ ìš”ì•½

- Mutation ë¶„ë¦¬: `useSegmentMutation.ts` ë“±ìœ¼ë¡œ ë‚˜ëˆ„ê³  `onSuccess`, `onError` í•¸ë“¤ë§ ëª…í™•íˆ
- Optimistic Update: mutationì—ì„œ optimisticí•˜ê²Œ UI ë°˜ì˜ í›„ rollback ì²˜ë¦¬ ê°€ëŠ¥ì„± ê³ ë ¤
- Error Boundary: ì „ì—­ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ìœ„í•œ React `ErrorBoundary` ë„ì… ê¶Œì¥
- Cache ì „ëµ ëª…ì‹œ: `staleTime`, `cacheTime`, `refetchOnWindowFocus` ë“± ì„¸ë¶€ ì˜µì…˜ ì •ì˜

---

### ğŸ”¸ ì°¸ê³ í•  ê¸°ì¡´ ì½”ë“œ

- `useSegments.tsx`ì²˜ëŸ¼ ì´ë¯¸ React Query ê¸°ë°˜ìœ¼ë¡œ ë¦¬íŒ©í† ë§ëœ í›…ë“¤ì´ ìˆìœ¼ë¯€ë¡œ,  
  ê·¸ êµ¬ì¡°ë¥¼ ë”°ë¼ `useProjectQuery`, `useTMQuery`, `useSegmentMutation` ë“±ìœ¼ë¡œ ì ì§„ì  ì „í™˜ ê°€ëŠ¥
